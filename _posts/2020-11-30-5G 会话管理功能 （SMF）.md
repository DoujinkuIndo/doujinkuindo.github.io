---
layout: post
title: 5G会话管理功能（SMF）
---


5G 会话管理功能 （SMF） 是 5G 基于服务的架构 （SBA） 的基本要素。SMF 主要负责与分离的数据平面进行交互，创建更新和删除协议数据单元 （PDU） 会话，并与用户平面函数 （UPF） 管理会话上下文。

<!--more-->

![what-is-an-smf-5g-blog-1](https://www.metaswitch.com/hs-fs/hubfs/Blogs/what-is-an-smf-5g-blog-1.png?width=902&name=what-is-an-smf-5g-blog-1.png)

_基于服务的架构中的会话管理功能_

UE 和 gNB 都使用下一代应用程序协议 （NGAP） 在 N1 或 N2 引用接口上传输非访问层 （NAS） 消息，以便请求新会话。访问和移动管理功能 （AMF） 接收这些请求并处理与连接或移动管理相关的任何操作，同时通过 N11 接口将会话管理要求转发到 SMF。AMF 通过查询网络存储库功能 （NRF） 确定哪个 SMF 最适合处理连接请求。该接口和 AMF 和 NRF 分配的特定 SMF 之间的 N11 接口使用基于服务的接口 （SBI） 消息总线，所有服务基础应用程序元素都连接到该接口。SBI 消息总线在 HTTP/2 上采用 RESTful API 原则 -- Web 技术，可显著简化和加快服务部署。

![amf-nrf-smf-call-flow](https://www.metaswitch.com/hs-fs/hubfs/Blogs/amf-nrf-smf-call-flow.png?width=1283&name=amf-nrf-smf-call-flow.png)

_SMF 注册和发现的基本 SBI 呼叫流，每个 3GPP TS 23.502_

通过 N11 接口接收的消息表示在用户平面上添加、修改或删除 PDU 会话的触发器。SMF 使用数据包转发控制协议 （PFCP） 通过 N4 参考接口向 UPF 发送消息。与 OpenFlow 类似，PFCP 在性质上采用了著名的 UDP 端口 （8805），最初在版本 14 规范中定义以支持控制和用户平面分离 （CUPS）。

在会话建立或修改期间，SMF 还通过 N7 接口与策略控制功能 （PCF） 和存储在统一数据管理 （UDM） 函数 （N10） 中的订阅者配置文件信息进行交互，该函数承担 HSS 以前执行的角色。PCF 采用 SBI 消息总线，提供了策略框架的基础，该框架与更典型的 QoS 和充电规则一起包括网络切片选择，该选择由网络切片选择功能 （NSSF） 调节。

将其他控制平面功能与用户平面分离，而（连同 AMF）假设 MME 以前执行的一些功能，SMF 执行 DHCP 服务器和 IP 地址管理 （IPAM） 系统的角色。SMF 与 UPF 一起，通过 24 位 PDU 会话 ID 维护 PDU 会话状态记录。SMF 在 UPF 中设置配置参数，用于定义流量转向参数，并确保适当的数据包路由，同时保证传入数据包的传递，但通过下行链路 （DL） 数据通知。在 4G EPC 体系结构中，这是 SGW 到 MME 消息。SMF 负责检查 UE 请求是否符合用户订阅和连接充电，这是通过与 3GPP TS 32.255 中定义的充电功能 （CHF） 交互实现的。

为了满足 5G 的体系结构要求，SMF 必须完全设计为云本地网络功能进行设计和交付，以完全自动化的方式动态部署和按需扩展。当涉及到高可用性控制组件时，这是一个特别复杂的命题，这些组件具有异步呼叫流，这些异地基础结构需要长时间和短期的状态维护，以便遍历元素的会话可能会静默而不另行通知。因此，这些功能必须采用已建立的设计模式来构建和部署可大规模扩展的 Web 应用程序，同时适应实时通信网络的限制。REST 本质上是无状态的，3GPP 定义了结构化和非结构化数据存储功能 （UDSF），任何网络功能都可以使用该功能实现无状态可靠性和负载分布。但是，这些设计原则的牢固背景最终需要提供真正的云原生 5G 会话管理功能。
