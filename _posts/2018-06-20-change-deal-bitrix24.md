---
layout: post
title: Правильно обновлять Ответственного в сделках Bitrix24 КП
---

И так. Нужно перебить поле отвественного во всех сделках заново, чтобы сами отвественные видели эти сделки. Потому что кто-то напрямую вносил изменения в БД минуя API битрикса, при внесении сделок.

Имеем > 586 тыс. сделок (deal) на портале. В таблице **b_crm_entity_perms** из-за кривого внесения неправильно прописаны права на доступ к сделкам. Автор создавший сделок видит а отвественный пользователь нет.

Поэтому, разработал скрипт который пробегается по всем сделкам. И на основе записи по полю ответственный «ASSIGNED_BY_ID» у сделки обновлять таблицу прав доступа к ниму.
<script src="https://gist.github.com/davletyarov/d0b50381d65341e7f50532fd2444a209.js"></script>


Вся проблема была из-за того что после создания сделки кривым способом, не был вызван штатный БП на редактирования сделок.
Бизнес-процесс не обрабатываются автоматически по событию. Либо же нужно было добить код, и чтобы в таблице **b_crm_entity_perms** были пробиты id отвественных менеджеров.

Если вдруг вылезут ошибки при обновления прав, то в корне проекта должно появиться лог __bx_log.log c записями от чего все.
