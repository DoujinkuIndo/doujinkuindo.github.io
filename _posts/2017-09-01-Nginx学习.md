## Nginx 学习

nginx做本地目录映射

    有时候需要访问服务器上的一些静态资源，比如挂载其他设备上的图片到本地的目录，而本地的目录不在nginx根目录下，这个时候就需要简单的做一下目录映射来解决，比如想通过浏览器http://ip/image/e2/7d/c27df08cdae8ce784a199d8004ef4f81.jpg访问到系统目录/public/uploads/e2/7d/c27df08cdae8ce784a199d8004ef4f81.jpg需要在nginx.conf中添加location规则，配置如下：

```js
location /image/ {
    root /;
    rewrite ^/image/(.*)$ /image_data/$1 break;
}
```

location /image/设置服务器拦截含有/image/的请求，实际上范围根据实际情况确定精确度

root /;设定作用的根目录，rewrite就是真正的跳转规则，设置以uploads为开头的请求跳转到/uploads开头的根目录，后面的参数原封不动的添加过去，这样就实现了目录的映射，

使用上面的规则可以很方便的映射到本地指定的多个用于静态访问的目录

保存之后使用 ./nginx -s reload 重新载入配置文件，访问指定的url就访问到了

#nginx+php升级后错误An error occurred.解决办法
PHP的PHP-FPM服务是启动成功的，nginx也是启动成功的，折腾了几次，看nginx错误日志，发现有权限错误～
查看php-fpm.conf文件中相关配置，得出解决办法：

;listen.user = nobody
;listen.group = nobody
去掉前面的;号，然后将用户和用户组换成你的用户和用户组即可！

# 官网支持PHP的配置
location ~ .php$ {
#root html;
fastcgi_pass 127.0.0.1:9000;
fastcgi_index index.php;
fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
include fastcgi_params;
}

然而在对nginx添加fastCGI的支持后，然后进行php页面验证，发现页面识别不到
报错信息：[error] 12691#0: *6 FastCGI sent in stderr: "Primary script unknown" while reading response header from upstream, client: 192.168.168.1, server: localhost, request: "GET / HTTP/1.1", upstream: "fastcgi://127.0.0.1:9000", host: "192.168.168.133"
错误原因及解决方法：
fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
而Nginx识别不到/scripts路径，所以phpinfo验证信息就无法正常通过，需要修改如下：
fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;

Note:
$document_root 代表当前请求在root指令中指定的值。
我们这里为系统默认，
location / {
       root   /usr/local/nginx/html;
       index  index.php index.html index.htm;
        }
所以该语句就是针对/usr/local/nginx/html目录下的php文件进行解析。