---
layout: test
title:  " Y2 Elec arm Group26"
---

# EVERY LAB ATTANDENCE TRACKING

![Screen Shot 2023-02-28 at 1.10.41 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_1.10.41_AM.jpg "Fig 1.3")


# Overall contribution calculation
Shan's log book amount 	528 words
Zak 's log book amount  414 words
Zuoyuan 's log book amount  3720 words
Jiaqi 's log book amount  22422 words

 We used the total number of log texts as a percentage to calculate each person's contribution to the overall project separately. Since the project report was not completed at the time of the calculation, the final contribution ratio will have a slight deviation.

#### ${Everyone\ contribution}=\frac{Per\ person\ log\ words\ amount}{ All\ people\ log\ word\ amount}$

| Person                          | contribution|
| ------------------------------- | ------------|
| Shahzeb Pasha(201578653)        | 1.95%       |
| Zak Stirling (201574452)        | 1.52%       |
| Jiaqi Yan (20167313)            | 82.79%      |
| Zhuoyuan Liu (201676754)        | 13.73%      |

It will be update in final, because our report contribution not be counted, which will be submitted on 13th March. Shah and Zak followed our report2 earlier in the week, but they did not provide weekly proofs (screenshot). When Jiaqi asked Zak on 1 st March what he had already done, he did not get any response.


# Everyone log here
### Shah：

![Screen Shot 2023-02-28 at 4.03.47 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_4.03.47_AM.jpg "unamed")

                                                                           Fig 0.2

### Zak：

![Screen Shot 2023-02-28 at 4.05.29 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_4.05.29_AM.jpg "unamed")

                                                                          Fig 0.3

### Zhuoyuan Liu:

![Screen Shot 2023-02-28 at 4.07.46 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_4.07.46_AM.jpg "unamed")

                                                                           Fig 0.3
 ### Jiaqi Yan:                           
 # 95% OF THE TEXT AND IMAGES BELOW WERE WRITTEN BY ME.    
 # This means that the first week was created by Zhuoyuan, the AA session scans paper were written by Shah, and the rest was my contribution.
 # I spent 40 hours in the last week 4, because the others didn't do anything.
 # Any "HELP" from Zak and shah which they wrote above, I did not know and not help.
 # First task I gave to Shah is tech report but he just copy.
 # Zak spend A whole week to do a circuit diagram. I spend about 1 hour to teach him how to open Fritzing on Win
 # He just copy the an example daigram connecting the GND and 5V cords derictly. Genius! GOOD JOB!!!
 # OK! Very Help!!!!
 # THX YOUR GUYS TEACH ME HOW TO GROUP WORK.
 # But my AA tells us that ZAK good job!!! You've done a lot of things. 
 # Very Very good job thx again.
# week 1

In the first week, we will focus on the design of the robot arm and learning the basics.

- Continue to complete ethic sheet signatures and submit relevant information
- Zhuoyuan submits the first componment purchase form

| Part                            | Quantity |
| ------------------------------- | -------- |
| 995 or 946 servo                | 3        |
| SG90 SERVO                      | 4        |
| M6 selflocking nut              | 6        |
| M6x25 screw                     | 1        |
| M3 selflocking nuts             | 2        |
| M3 x 20 screws                  | 1        |
| M3 x 10 hex recessed head screw | 2        |
| M4 selflocking nuts             | 9        |
| M4 x 40 screw                   | 1        |
| M4 x 30 screw                   | 1        |
| M4 x 20 screw                   | 1        |
| M4 x 60mm threated rod          | 1        |
| M4 x 32mm threated rod          | 1        |
| Ø6 mm ball spheres              | 25       |
| 606zz bearing x10               | 1        |
| M4 washers                      | some     |

                                                                      Table 1.1

- Jiaqi and Zhuoyuan learn arduino idea to understand the basic principles of Arduino and programming language. Learn the basic structure of Arduino, how to use the Arduino board and programming software, and how to write simple programs. We also learn to understand basic circuit knowledge and how to use the circuit to control the robot arm.
- Assign tasks and start recording sign-in
- In the last semester, we initially decided to make a robotic arm system and find a suitable robot arm arm test solution. We identified the goals and needs of the project, including the basic structure and motion control of the robotic arm. We discussed the tasks that the robot arm needed to accomplish, as well as the physical structure of the arm and the underlying principles of motion control. The EEZYbotARM MK2 3Dprintable robotic arm solution was finally selected [1].

![Untitled](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Untitled.jpeg "Fig 1.3")

                                  Fig 1.1[1]                                          

![Untitled](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Untitled%201.jpeg "Fig 1.3")

                                 Fig 1.2[1]

Objectives: The book “Programming Arduino: getting started with sketches” [1] shows basic syntax and some project examples for how to programme Arduino board. Use computers and Arduino board to practice.

Methodology: Use Arduino syntax to write some easy projects to make sure those syntax have been learned.

Results:

Analysis: All the designed programmes perform successfully.

Challenges: Descriptions in the book is not clear and easy enough to understand. For misunderstood parts, searching on Internet will provide more details.

Next step: Next week, some experiments about servo motor and using PCA9685 control motors work together.

Week 1: Zak and Shan helped write logbooks for weekly lab sessions for week1. But, They were absent for the first experiment.

![Screen Shot 2023-02-27 at 11.08.04 PM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-27_at_11.08.04_PM.jpg "Fig 1.3")


                                                                    Fig 1.3  

# week 2

In the second week, we will focus on writing the Arduino program and testing the basic movements of the robot arm. Our arm was not printed because of the long waiting time for 3D printing and AA questioned the instability of 3D printing. We abandoned the 3D printing plan and chose the new open source design meArm[2] on Friday to laser cut our parts. zak offered to assemble our Arm from a wooden structure.

![Untitled](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Untitled.png "Fig 1.3")

                                                                   fig 2.1[2]

- Jiaqi selects the right 3D printing file to submit to AA

- Jiaqi uses github to create the blog's home page, while choosing the right theme

  ![Screen Shot 2023-02-27 at 11.37.06 PM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-27_at_11.37.06_PM.jpg "Fig 1.3")

                                                                     Fig 2.2

- Zhuoyuan inspected and tested the purchased parts, compared the design of the robot arm, and learned the background knowledge about the complex parts.

```HTML
<video width="480" height="480" controls>
    <source src="/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/WhatsApp_Video_2023-02-22_at_23.30.31.mp4" type="video/mp4">
</video>
```

- Based on the open source information, zak used fritzing to draw preliminary circuit diagrams that were used to add to the report and poster.

- Shan and Zak redesigned our build plan based on the open source information

  ![Screen Shot 2023-02-27 at 11.10.24 PM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-27_at_11.10.24_PM.jpg "unamed")

                                                                     Fig 2.3

This sheet was written by Shan. We were all present this week.

![Screen Shot 2023-02-28 at 12.29.41 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_12.29.41_AM.jpg "unamed")

                                                                    Fig 2.4

# week 3

We got our components, but due to our new decisionwhich was we decided to use the mearm as our arm design. We assembled the arm.

![Untitled](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Untitled%202.jpeg "unamed")

                                                                       Fig 3.1

### We have encountered new problems

We submitted two requests for laser cutting, but we only got one part, which led us not to have any failures in assembly, such as material breakage. Fortunately, since we chose 3mm material for laser cutting, we did not encounter any failure in practice.

- During assembly, the screws were replaced from M3 to M2.5 because we decided to use a new design solution where the original screw and nut sizes did not match. M2.5 is a custom model, instead of M3 screws which are a more common model, which is what caused us to spend a lot of time at week3 looking for the right screws. In some positions of the robot arm, we used tape to fix it, and some used M2 plus nut to fix it, these are the compromise solution without suitable parts. During the experiment time, we spent 3 hours looking for the right parts.

- The regulator power supply chip was of poor quality, the expected output of 5v got an actual voltage of 8v-9v which caused our motor to be burned up and we re-purchased a new motor and new ardunio.

  ![Screen Shot 2023-02-28 at 12.40.47 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_12.40.47_AM.jpg "unamed")


                        Fig 3.2

![Screen Shot 2023-02-28 at 12.41.34 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_12.41.34_AM.jpg "unamed")

                                 Fig 3.3

- The purchased ardunio version is the basic version, the number of pins is not enough, Jiaqi redesigned the circuit.

- Zhuoyuan continued the testing of the parts

- Zhuoyuan conducted tests with Bluetooth and got erratic results. This led to a huge amount of testing in the actual use of Jiaqi.

- The output of the color sensor failed very much, not the result we expected, for example, the color sensor should output a color RGB specific value (blue: 13, 10, 255), but what we actually get is (36, 19, 9), this result is beyond our expectation, we spent a lot of time to consult the information to solve this problem. Initially, we believe that the LEDs and ambient light affect the actual detection results. Also the sensor has an internal function that affects the output result. We still have not solved this problem in week 4.

  ![Screen Shot 2023-02-27 at 11.54.36 PM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-27_at_11.54.36_PM.jpg "unamed")

                                                                        Fig 3.4

- Zak and Shan formed our other wooden robot arm solution, but it did not work. Because the claws were not available. Almost the time spent was 4 hours to form the wooden robotic arm.

  ![Screen Shot 2023-02-28 at 12.12.52 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_12.12.52_AM.jpg "unamed")

                                                                         Fig 3.5

- Jiaqi and Zhuoyuan made our robot arm for laser cutting

  ![Screen Shot 2023-02-28 at 12.35.06 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_12.35.06_AM.jpg "unamed")

                         Fig 3.6

![Screen Shot 2023-02-28 at 12.36.58 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_12.36.58_AM.jpg "unamed")

                        Fig 3.7

In the next week Jiaqi plans to program the control code for the arm.

This sheet was written by Shan. We were all present this week.

![Screen Shot 2023-02-28 at 12.52.34 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_12.52.34_AM.jpg "unamed")

                                                                        Fig 3.8

# Week 4

During the week, Jiaqi focused on writing the Arduino program and testing the basic movements of the robotic arm, testing and modifying the program. At the end of the week Jiaqi made sure the basic movements of the robotic arm could be achieved. Jiaqi also tested the range of motion, speed, and accuracy of the robotic arm, and optimized and modified the program to make sure the basic movements of the robotic arm could be performed stably. Also, we added color recognition sensors for feedback and control of the robotic arm. Zhuoyuan and Jiaqi understand the principles and use of the sensors and added them to the robotic arm to provide control. If we have enough time, we plan to test and optimize the inverse kinematics and path planning algorithms. We will debug and test the program to ensure that the robotic arm is able to perform the required tasks accurately. Obviously due to the amount of time we wasted assembling our robotic arm and collecting parts on week 1 through 3, we did not accomplish our final goal. Zak and Shan started our poster and report writing.

## Thur. ( Lab time

We finally finished the assembly of the robot arm on Thursday during the experiment time. But the problem was that our code was not available. zhuoyuan wrote out a solution for direct control of the 4 motors by ardunio that failed, while we found the debugging of the bluetooth sensors to be a difficulty that we had not previously envisioned. Here we felt we should try to use a line connected controller for the actual control, but time did not allow us to reorder new parts. Zak and Shan continued to finish the poster and some other text work during the experiment time. So at the AA meeting on Thursday we didn't show the finished product we had made.

![Screen Shot 2023-02-28 at 1.04.01 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_1.04.01_AM.jpg "unamed")

                                                                         Fig 4.1

This sheet was written by Shan. We were all present this week.

![Screen Shot 2023-02-28 at 1.09.54 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_1.09.54_AM.jpg "unamed")

                                                                         Fig 4.2

## Fri.

On Friday Jiaqi spent a lot of time debugging the signal output of the Bluetooth chip. Since we designed the Bluetooth chip to send all the signals if the Bluetooth chip is not available, then our whole project will go bankrupt.

### Bluetooth debugging

During the lab time, the Bluetooth chip HC05 worked successfully and was set up successfully. But in the subsequent test, our phone never connected to the Bluetooth chip, it was in a continuous half clock state, we first test the voltage cause. The voltage caused a short circuit in the line device damage or insufficient voltage. Finally, a closer inspection of the circuit revealed that there was no problem, but the fault existed.

![Untitled](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Untitled%203.jpeg "unamed")

                                                                         Fig 4.3

As the Bluetooth chip is set, try to learn how Bluetooth works and modulate the Bluetooth chip HC-05 using At command. Since the usb modulation tool was not purchased. Use the following code to make a usb modulation tool using ardunio, TX-TX, RX-RX plugged into the computer, and use the serial modulation tool to reset the Bluetooth chip.

```cpp
void setup() {
  // put your setup code here, to run once:
  pinMode(0,INPUT_PULLUP);
  pinMode(1,INPUT_PULLUP);
}
void loop() {
 

}
```

However, the “OK” signal is never received in modulation mode. Modulation mode failed.

![Screen Shot 2023-02-28 at 1.28.45 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_1.28.45_AM.jpg "unamed")

                              Fig 4.4

- Finally, the problem was found that the Bluetooth chip could not work effectively because the baud rate setting failed.

![Screen Shot 2023-02-28 at 1.30.37 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_1.30.37_AM.jpg "unamed")

                          Fig 4.5

![Screen Shot 2023-02-28 at 1.31.19 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_1.31.19_AM.jpg "unamed")

                                                                         Fig 4.6

Enter the command`AT+UART=9600,0,0` to reset the baud rate back to the default value and the Bluetooth chip modulates successfully. But in the end we used a baud rate of 38400 which caused a lot of problems in the later tests.

### The robot arm moving code 「step by step」  Sat.Afteroon

Jiaqi started writing the code to control the Arduino robot arm. This robot arm has 4 degrees of freedom and can move in 3D space after a Bluetooth signal is sent.

I first imported the Servo library to use the servo controller on the Arduino board. Next, I created 4 Servo objects corresponding to each of the 4 positions of the robot arm. These servos were connected to the digital pins of the Arduino board so that their positions could be controlled programmatically. I drew the circuit diagram using firtzing, as shown below.

Then, I created a function to move the joints of the robot arm. The function takes 4 arguments, each corresponding to one joint of the arm. The function internally uses the write function of the Servo library to send the desired angle value to each servo, which controls the position of the arm. Here is the abbreviated code. Note that this code is a demonstration example, where each motor has its own angle. To avoid damaging the motors, it should not be used directly.

```cpp
#include <Servo.h>

// Define servo objects
Servo servo1;
Servo servo2;
Servo servo3;
Servo servo4;

// Define servo angles
int angle1 = 0;
int angle2 = 0;
int angle3 = 0;
int angle4 = 0;

void setup() {
  // Initialize servo objects
  servo1.attach(2);
  servo2.attach(3);
  servo3.attach(4);
  servo4.attach(5);
  
  // Move servos to default positions
  moveArm(0, 0, 0, 0);
}

void loop() {
  // Move arm to different positions
  moveArm(90, 45, 135, 180);
  delay(1000);
  moveArm(0, 0, 0, 0);
  delay(1000);
}

// Move the arm to the specified positions
void moveArm(int pos1, int pos2, int pos3, int pos4) {
  // Map positions to a value between 0 and 180 degrees
  angle1 = constrain(pos1, 0, 180);
  angle2 = constrain(pos2, 0, 180);
  angle3 = constrain(pos3, 0, 180);
  angle4 = constrain(pos4, 0, 180);
  
  // Move servos to the specified positions
  servo1.write(angle1);
  servo2.write(angle2);
  servo3.write(angle3);
  servo4.write(angle4);
}
```

![Untitled](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Untitled%204.jpeg "unamed")

                                                                         Fig 4.7

### The robot arm 「smoothly 」  Sat. Night

Jiaqi decided to use the PCA9685 controller to control the motors on my Arduino robot arm. The PCA9685 was chosen because it reduces the number of pins required and provides better accuracy and reliability.

![IMG_3768.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/IMG_3768.jpg "unamed")

                                                                         Fig 4.5

During the second week of learning, I learned how to use the PCA controller and successfully imported the Adafruit PCA9685 library. By connecting the motor to the output pins of the PCA controller, I was able to control the speed and direction of the motor.

I then created a function to control the speed and direction of the motor. The function accepts two arguments, the first to specify the motor channel to be controlled and the second to specify the speed and direction of the motor. The function internally uses the setPWM() function from the Adafruit PCA9685 library to set the output signal of the PCA controller and control the motor.

To make sure my code was controlling the motors on the robot arm correctly, I wrote a test program. Below is my code and the circuit diagram drawn using fritzing.

```cpp
#include <Wire.h>
#include <Adafruit_PWMServoDriver.h>
#include <SoftwareSerial.h>

// Initialize the PWM servo driver
Adafruit_PWMServoDriver pwm = Adafruit_PWMServoDriver();

// Define the PCA9685 addresses and pins for the MeArm
#define PCA9685_ADDR 0x40
#define SERVO_BASE_PIN 12
#define SERVO_LEFT_PIN 14
#define SERVO_RIGHT_PIN 13
#define SERVO_GRIP_PIN 15

// Define the servo positions for each joint
#define BASE_MIN 0
#define BASE_MAX 180
#define LEFT_MIN 60
#define LEFT_MAX 115
#define RIGHT_MIN 20
#define RIGHT_MAX 100
#define GRIP_MIN 90
#define GRIP_MAX 170

// Set the current servo positions to the minimum values
int basePos = BASE_MIN;
int leftPos = LEFT_MIN;
int rightPos = RIGHT_MIN;
int gripPos = GRIP_MIN;

// Define the Bluetooth module pins
#define BT_TX_PIN 4
#define BT_RX_PIN 5
char command;
// Setting pwm angle
float mapTo(float val, float I_Min, float I_Max, float O_Min, float O_Max) {
  return (((val - I_Min) * ((O_Max - O_Min) / (I_Max - I_Min))) + O_Min);
}
int ts(int angle) {
  float an = mapTo((float)angle, 0, 180, 0.5, 2.5);
  int re = an / 20 * 4096;
  Serial.println(re);
  return re;
}

// Initialize the Bluetooth module
SoftwareSerial BTSerial(BT_TX_PIN, BT_RX_PIN);

void setup() {
  // Start the I2C communication
  Wire.begin();

  // Initialize the PWM servo driver
  pwm.begin();
  pwm.setPWMFreq(50);  // Set the PWM frequency to 60Hz

  // Set the PCA9685 address and reset the servos
  pwm.setPWM(SERVO_BASE_PIN, 0, BASE_MIN);
  pwm.setPWM(SERVO_LEFT_PIN, 0, LEFT_MIN);
  pwm.setPWM(SERVO_RIGHT_PIN, 0, RIGHT_MIN);
  pwm.setPWM(SERVO_GRIP_PIN, 0, GRIP_MIN);

  // Start the Bluetooth communication
  BTSerial.begin(38400);
  Serial.begin(38400);
}

void loop() {
  // Check if there is data available from the Bluetooth module
  if (BTSerial.available()) {
    // Read the incoming data
    char command = BTSerial.read();
    Serial.println("BT signal");
    Serial.println(command);
    // Move the base servo
    if (command == 'A') {
      basePos += 5;
      if (basePos > BASE_MAX) {
        basePos = BASE_MAX;
      }
      pwm.setPWM(SERVO_BASE_PIN, 0, ts(basePos));
    } else if (command == 'a') {
      basePos -= 5;
      if (basePos < BASE_MIN) {
        basePos = BASE_MIN;
      }
      pwm.setPWM(SERVO_BASE_PIN, 0, ts(basePos));
    }

    // Move the left servo
    else if (command == 'B') {
      leftPos += 5;
      if (leftPos > LEFT_MAX) {
        leftPos = LEFT_MAX;
      }
      pwm.setPWM(SERVO_LEFT_PIN, 0, ts(leftPos));
    } else if (command == 'b') {
      leftPos -= 5;
      if (leftPos < LEFT_MIN) {
        leftPos = LEFT_MIN;
      }
      pwm.setPWM(SERVO_LEFT_PIN, 0, ts(leftPos));
    }

    // Move the right servo
    else if (command == 'C') {
      rightPos += 5;
      if (rightPos > RIGHT_MAX) {
        rightPos = RIGHT_MAX;
      }
      pwm.setPWM(SERVO_RIGHT_PIN, 0, ts(rightPos));
    } else if (command == 'c') {
      rightPos -= 5;
      if (rightPos < RIGHT_MIN) {
        rightPos = RIGHT_MIN;
      }
      pwm.setPWM(SERVO_RIGHT_PIN, 0, ts(rightPos));
    }

    // Move the grip servo
    else if (command == 'D') {
      gripPos += 100;
      if (gripPos > GRIP_MAX) {
        gripPos = GRIP_MAX;
      }
      pwm.setPWM(SERVO_GRIP_PIN, 0, ts(gripPos));
    } else if (command == 'd') {
      gripPos -= 100;
      if (gripPos < GRIP_MIN) {
        gripPos = GRIP_MIN;
      }
      pwm.setPWM(SERVO_GRIP_PIN, 0, ts(gripPos));
    } 
    // Reset all servo
    else if (command == 'E') {
      pwm.setPWM(SERVO_GRIP_PIN, 0, ts(90));
      pwm.setPWM(SERVO_RIGHT_PIN, 0, ts(20));
      pwm.setPWM(SERVO_LEFT_PIN, 0, ts(60));
      pwm.setPWM(SERVO_BASE_PIN, 0, ts(90));
    }
  }
}
```

![Untitled](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Untitled%205.jpeg "unamed")

                                                                         Fig 4.6

### Color sensor problem      Sun.night

Measured color values do not correspond to true color values

Use the Adafruit TCS34725 library to read the color sensor values and output the color information to the serial monitor.
The color sensor was connected to the I2C bus of the Arduino board and the Adafruit TCS34725 library was imported. Then, a function was created to read the value of the color sensor. The function used the getRawData() function of the Adafruit TCS34725 library to get the red, green, blue and transparency values and output these values to the serial monitor.
The comparison revealed a serious deviation between the read and actual values of red green and blue.
I think we need to do some calculations to get the actual color information from the sensor values due to the sensor errors. I modified my code to add some calculation process to convert the sensor values to actual RGB values and output to the serial monitor.

This was not resolved at the end of week4. Our robot arm is still not able to give feedback using the color sensor input.

![Screen Shot 2023-02-28 at 4.10.50 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_4.10.50_AM.jpg  "unamed")

                                                                         Fig 4.7 value for black

![Screen Shot 2023-02-28 at 4.11.11 AM.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Screen_Shot_2023-02-28_at_4.11.11_AM.jpg "unamed")

                                                                         Fig 4.8 value for white

I wrote a test program. Below is my code and the circuit diagram drawn using fritzing.

![Untitled](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Untitled%206.jpeg "unamed")

                                                                            Fig 4.9

# Week 5 （EXTRA

### our work Mon.

Since our project was not finished, we continued our project in the library.

Jiaqi's remaining job is to finish our code, converge our log book, try to finish our sensor detection function, supervise Zak & Shan to finish the text work, and Zhuoyuan is helping Jiaqi to do the final test on the color sensor and troubleshoot the problem.

Finally, I found this problem in code. This issue is a code error caused by a function change. At this code block, the function to control the rotation of the servo of the claw is changed to arm down. This bug has been unnoticed until now

```cpp
void loop() {
 // positioning_control();
  RGB_read();
  // if (R <= 255 && R >= 100 && G <= 255 && G >= 100 && B <= 255 && B >= 100) {
  if (R <20 && G <20&& B < 20) {
    rightPos = 100;
    ***pwm.setPWM(SERVO_GRIP_PIN, 0, ts(rightPos));***

  }
  delay(100);
  
}
```

Due to the inaccuracy of color recognition, I canceled the function of recognizing various colors and only recognized black. This function is realized by this judgment condition

```cpp
if (R <20 && G <20&& B < 20) {
//
}
```

Finally I solved this problem. Our final code is the block shows below.

```cpp
#include <Wire.h>
#include <Adafruit_PWMServoDriver.h>
#include <SoftwareSerial.h>
// Initialize the PWM servo driver
Adafruit_PWMServoDriver pwm = Adafruit_PWMServoDriver();

// Define the PCA9685 addresses and pins for the MeArm
#define PCA9685_ADDR 0x40
#define SERVO_BASE_PIN 12
#define SERVO_LEFT_PIN 14
#define SERVO_RIGHT_PIN 13
#define SERVO_GRIP_PIN 15
// Define the servo positions for each joint
#define BASE_MIN 0
#define BASE_MAX 180
#define LEFT_MIN 60
#define LEFT_MAX 115
#define RIGHT_MIN 20
#define RIGHT_MAX 100
#define GRIP_MIN 90
#define GRIP_MAX 170
// Set the current servo positions to the minimum values
int basePos1 = 90;
int leftPos1 = 60;
int rightPos1 = 20;
int gripPos1 = 90;

int basePos = 90;
int leftPos = 60;
int rightPos = 20;
int gripPos = 90;

// Define the Bluetooth module pins
#define BT_TX_PIN 4
#define BT_RX_PIN 5
SoftwareSerial BTSerial(BT_TX_PIN, BT_RX_PIN);

#define S0 2
#define S1 3
#define S2 6
#define S3 7
#define sensorOut 8
int R, G, B;

float mapTo(float val, float I_Min, float I_Max, float O_Min, float O_Max) {
  return (((val - I_Min) * ((O_Max - O_Min) / (I_Max - I_Min))) + O_Min);
}
int ts(int angle) {
  float an = mapTo((float)angle, 0, 180, 0.5, 2.5);
  int re = an / 20 * 4096;
  // Serial.println(re);
  return re;
}

void positioning_control() {
  // Check if there is data available from the Bluetooth module
  if (BTSerial.available()) {
    // Read the incoming data
    char command = BTSerial.read();
    Serial.println("BT signal");
    Serial.println(command);
    // Move the base servo
    if (command == 'A') {
      basePos += 20;
      if (basePos > BASE_MAX) {
        basePos = BASE_MAX;
      }
      pwm.setPWM(SERVO_BASE_PIN, 0, ts(basePos));
    } else if (command == 'a') {
      basePos -= 20;
      if (basePos < BASE_MIN) {
        basePos = BASE_MIN;
      }
      pwm.setPWM(SERVO_BASE_PIN, 0, ts(basePos));
    }
    // Move the left servo
    else if (command == 'B') {
      leftPos += 20;
      if (leftPos > LEFT_MAX) {
        leftPos = LEFT_MAX;
      }
      pwm.setPWM(SERVO_LEFT_PIN, 0, ts(leftPos));
    } else if (command == 'b') {
      leftPos -= 20;
      if (leftPos < LEFT_MIN) {
        leftPos = LEFT_MIN;
      }
      pwm.setPWM(SERVO_LEFT_PIN, 0, ts(leftPos));
    }
    // Move the right servo
    else if (command == 'C') {
      rightPos += 20;
      if (rightPos > RIGHT_MAX) {
        rightPos = RIGHT_MAX;
      }
      pwm.setPWM(SERVO_RIGHT_PIN, 0, ts(rightPos));
    } else if (command == 'c') {
      rightPos -= 30;
      if (rightPos < RIGHT_MIN) {
        rightPos = RIGHT_MIN;
      }
      pwm.setPWM(SERVO_RIGHT_PIN, 0, ts(rightPos));
    }
    // Move the grip servo
    else if (command == 'D') {
      gripPos = 170;
      pwm.setPWM(SERVO_GRIP_PIN, 0, ts(gripPos));
    } else if (command == 'd') {
      gripPos = 90;
      pwm.setPWM(SERVO_GRIP_PIN, 0, ts(gripPos));
    } else if (command == 'R') {
      basePos = basePos1;
      leftPos = leftPos1;
      rightPos = rightPos1;
      gripPos = gripPos1;
      pwm.setPWM(SERVO_BASE_PIN, 0, ts(basePos1));
      pwm.setPWM(SERVO_LEFT_PIN, 0, ts(leftPos1));
      pwm.setPWM(SERVO_RIGHT_PIN, 0, ts(rightPos1));
      pwm.setPWM(SERVO_GRIP_PIN, 0, ts(gripPos1));
    }
  }
}
void RGB_read() {
  // Setting red filtered photodiodes to be read
  digitalWrite(S2, LOW);
  digitalWrite(S3, LOW);
  // Reading the output frequency
  R = pulseIn(sensorOut, LOW);
  //Remaping the value of the frequency to the RGB Model of 0 to 255
  //R = map(R, 25, 72, 255, 0);
  // Printing the value on the serial monitor
  delay(100);
  digitalWrite(S2, HIGH);
  digitalWrite(S3, HIGH);
  G = pulseIn(sensorOut, LOW);
  //Remaping the value of the frequency to the RGB Model of 0 to 255
  //G = map(G, 30, 90, 255, 0);
  // Printing the value on the serial monitor
  delay(100);
  // Setting Blue filtered photodiodes to be read
  digitalWrite(S2, LOW);
  digitalWrite(S3, HIGH);
  // Reading the output frequency
  B = pulseIn(sensorOut, LOW);
  //Remaping the value of the frequency to the RGB Model of 0 to 255
  //B = map(B, 25, 70, 255, 0);
  Serial.print("R= ");  //printing name
  Serial.print(R);      //printing RED
  Serial.print(" G= ");  //printing name
  Serial.print(G);      //printing RED
  Serial.print(" B= ");  //printing name
  Serial.println(B);      //printing RED
  // Printing the value on the serial monitor
  delay(100);
}

void setup() {
   //Set BT power
  pinMode (13,OUTPUT);
  digitalWrite(13,HIGH);
  //Set LED power
   pinMode (9,OUTPUT);
  digitalWrite(9,HIGH);
  // Start the I2C communication
  Wire.begin();
  // Initialize the PWM servo driver
  pwm.begin();
  pwm.setPWMFreq(50);  // Set the PWM frequency to 60Hz
  // Set the PCA9685 address and reset the servos
  pwm.setPWM(SERVO_BASE_PIN, 0, ts(basePos));
  pwm.setPWM(SERVO_LEFT_PIN, 0, ts(leftPos));
  pwm.setPWM(SERVO_RIGHT_PIN, 0, ts(rightPos));
  pwm.setPWM(SERVO_GRIP_PIN, 0, ts(gripPos));

  pinMode(S0, OUTPUT);
  pinMode(S1, OUTPUT);
  pinMode(S2, OUTPUT);
  pinMode(S3, OUTPUT);
  pinMode(sensorOut, INPUT);
  // Setting frequency-scaling to 20%
  digitalWrite(S0, HIGH);
  digitalWrite(S1, LOW);
  // Start the Bluetooth communication
  BTSerial.begin(38400);
  Serial.begin(38400);
}
void loop() {
  positioning_control();
  RGB_read();
  // if (R <= 255 && R >= 100 && G <= 255 && G >= 100 && B <= 255 && B >= 100) {
  if (R <20 && G <20&& B < 20) {
    rightPos = 100;
    pwm.setPWM(SERVO_RIGHT_PIN, 0, ts(rightPos));

  }
  delay(100);
  
}
```

Zak & Shan continued with our poster. Here is the content of the poster they finished when they left (about 7:30pm).

![Untitled](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/Untitled%201.png "unamed")

                                                                             Fig 5.1 

At Jiaqi's request, everyone submitted their own log books, which were summarized by Jiaqi. And together with Jiaqi's log book content to form our group's log book which Jiaqi provided before.

# Tue 
Jiaqi did(improved) our poster.
![poster.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/poster.jpg "unamed")
Jiaqi created Google blog for our project，whose material provided by Zhuoyuan.
![plogshot.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/plogshot.jpg "unamed")
Jiaqi send our blog and log info to UoL Y2 directory.
![postemail.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/postemail.jpg "unamed")
Jiaqi is waiting group members provide their contribution detial to finish the contribution sheet.
# Wed
Jiaqi received the poster from Shah. He wanna me add the pic for the poster. But I think it is too much words and the gap is too small.
So,I can not.
I attached the shah did below.
![posterbyshah.jpg](/images/Y2%20Elec%20arm%20Group26%208e36cc20ae814b1ba83827f84527ab26/posterbyshah.jpg "unamed")
 
 # REFERENCE
[1] theGHIZmo (2018) "EBA MK2: Educational robot kit" [Online]. Available at: [http://www.eezyrobots.it/eba_mk2.html](http://www.eezyrobots.it/eba_mk2.html) 

[2] Mearm (2017)  [https://github.com/mimeindustries/mearm]
