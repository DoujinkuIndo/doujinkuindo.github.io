After a day off for the Fourth of July, I'm back writing some photometry codes. I want to start by figuring out a more accurate way to detect sources in an image, and to do that I'm going to use aperture photometry. I'll make a new code in the NGC6819 repo's ["photometry codes"](https://github.com/GosnellResearchGroupSummer2018/NGC6819) folder called "aperture_photometry.py" that will more accurately subtract the background from an image than the [code](https://github.com/GosnellResearchGroupSummer2018/NGC6819/blob/master/photometry%20codes/source_detection.py) I was using on [Tuesday](https://thom-ory.github.io/day-seven/). Also, instead of getting an image out, this code will save a text file to the desktop. This will actually be a very big first step that I think I'm close to completing; after today, if I'm able to do aperture photometry accurately, we'll have all the tools we need to get the data necessary to make color-magnitude diagrams. So, we should have that data by next week, and I can start writing a code that will draw HR-diagrams for us. If I am able to get all this done in a reasonable amount of time today, then I'll make a "master" code that will be called "accurate_source_detection.py" that will combine both previous codes; i.e., it will use aperture photometry to find the sources, save a text file to the desktop that gives information about those sources, and create an image that circles all sources in blue. 

## Coding
The first thing that I did was go back to [source_detection.py](https://github.com/GosnellResearchGroupSummer2018/NGC6819/blob/master/photometry%20codes/source_detection.py) and try to make it run a little bit better. It was detecting way more sources in the image than were actually there because of noise, especially towards the edges. So, I restricted the field of view to only look at the center of the image, increased the radius of the aperture from 3 to 7 arcseconds, and bumped up the threshold required to be considered a source (sigma level went from 3 to 7 and flux threshold went from 5σ to 12σ). This is what I got compared to the raw data: 

![sources]({{thom-ory.github.io}}/images/sources_2.png) ![rawdata]({{thom-ory.github.io}}/images/rawdata_2.png) 

_This is the same field as yesterday, but we are looking at a smaller section. The original image was 5644x5895 pixels. I took the square somewhat middle range of the image from 1250 ≤ x,y ≤ 3750 to use for source detection._

---
There's still an issue with the program reading really bright sources or sources that have a large angular size as multiple sources, but it's better than yesterday. However, while the program is generally correct, there are a few spots that are circled where I can't find a source in the raw data as well as a few spots I see in the raw data that aren't circled in the final image. Overall, I would call this test pretty unsuccessfull -- bad photometry. I decided to shrink the pixel range down even further to only 200x200, which is about the size of the images I've used for example exercises. This made everything different so I then went back to the original threshold level and aperture size. Now, looking at only 3000 ≤ x,y ≤ 3200, this is what I get: 

![sources_2]({{thom-ory.github.io}}/images/sources_3.png) ![rawdata_2]({{thom-ory.github.io}}/images/rawdata_3.png)

This looks a lot better. Remember, this is a reverse black and white image, so those white spots actually indicate an area of space that's not giving off any light, even though it looks like a star. Since this looks quite good, I would say the result of this test is learning that this code (and likely photutils itself) is much better suited to scanning small patches of the sky rather than that huge composite image. Still, there's the issue of reading larger sources as multiple sources. 

After this, I moved on to trying to figure out aperture photometry. 

## Aperture Photometry
In the [photutils reference material](https://photutils.readthedocs.io/en/stable/index.html) there are a few pages that seem really useful, like the ones on [aperture photometry](http://photutils.readthedocs.io/en/stable/aperture.html) and [background estimation](https://photutils.readthedocs.io/en/stable/background.html). Instead of diving into this code, I'm going to spend some time reading those. 
