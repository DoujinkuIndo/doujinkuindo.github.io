---
published: false
layout: post
title:  "(2011-)2014年年终总结：非技术"
date:   2015-02-07 14:28
categories: 工作 总结
---

下图是我对Pedro Domingos 2012年的论文“A few useful things to know about machine learning”[^ml_things]的总结，大图可以在[这里][big_pic]下载。

##按月份
###模型
####新用户流失预测
####发信、读信和回信概率预测
####用户标签，推荐理由
####搜狗号码通合作
####理想与现实：使用照片点赞数据扩展魅力会员库
####为无线开发两个算法：新用户流失预测和产品购买预测
####模型尝试GBDT和抽样方法

####VIP红娘约见服务预测
####易骗模型构建


###分类推荐尝试
####给男性新用户推美女并快速收到信
####按信件质量进行信件精细化分配
####扶贫推荐
####提升新注册会员的收信和发信体验
####支持猜你喜欢项目
####北京和四川的阈值控制测试

####流量预测改进
####加入生活照字段，以便应用于需要生活照的地方
####分平台推荐
####把1个月包月用户挪出
####效率优化：过滤效率
####优先展示在线会员
####每天起始点挪至17:00测试

###网警系统
####解决了pHash方法判断重复照片准确度不够的问题

####新用户是否为骗子的概率预测

###其他
####Hadoop升级
####统计监控使用Saiku
####算法平台开发

##关于推荐系统的经验和思考

###天真的算法年：2011-2013
2011年8月我加入世纪佳缘，开始时主要负责佳缘的交友推荐系统优化，后来我这个团队也负责其他的机器学习事情，比如佳缘的网警系统（抓恶意用户）。刚来时团队加上我只有3个人，做的事基本集中在推荐系统，以及对业务部门新产品的接口支持。当时我自己并没有推荐系统应用于工业界的实际经验，所以很想当然地就从自己了解的推荐算法开始工作了。

2011年到2013年中这段时间，我们在算法方面主要做了两个方向的尝试。第一个是尝试**item-based kNN**算法。对这个算法的优化尝试体现在以下几个方面：

* **离线计算效率的优化**：从开始的单机计算，到后来的Hadoop分布式计算。
* **离线计算效果的优化**：尝试了不同的相似度计算方法，但效果并不明显。
* **离线计算改为线上实时计算**：离线的工作方式是先在线下计算好推荐结果，然后把结果存入缓存；线上需要推荐结果时直接从缓存中取即可。显然这种方式对于缓存中没有推荐结果的用户无法产生推荐，而活跃的用户又很容易把缓存中的所有结果都消费完。为了解决这些问题，后来我们在Dubbo上构建了实时的Java推荐服务。

Item-based kNN算法的尝试最开始是基于最大化佳缘用户发信量的业务理解，但后来我们发现这个理解跟业务部门的需求偏差很大。比如给男性展示美女，男性的发信就会暴涨，但这样就会导致少量的女性收到大部分信，而大部分女性则没信可收。这是业务部门不愿意看到的。虽然我们尝试在item-based kNN基础上做调整来平衡其他的业务指标（如收信人数，看信人数），但效果不理想。

第二个尝试是学术界的**可逆（Reciprocal）**推荐算法，即在考虑用户体验的同时也兼顾item（对佳缘来说也是人）的体验。这个尝试基本是失败的，学术界发明的那些算法基本都有各种前提假设，真用起来都不太靠谱。


虽然到2013年我们团队人数上升到了六七人，但基本在推荐算法上做事的人还是只有两个左右。



###工程年：2014

从2013年底开始我逐渐意识自己对算法的理解过于学术而无法满足业务部门的各种需求。所以从2013年底我开始从业务出发重新梳理推荐算法团队的工作方向。相对于给用户推荐物品的场景，佳缘的在线交友推荐有以下几个特点：

* **可逆性**：佳缘的物品是异性的人，他们也会有感受。所以在推荐时要考虑到双方的感受。
* **资源独占性**：被推荐的资源是异性的人，通常一个人在一段时间内也就和一个人谈恋爱。这与电商卖东西是差别很大的，一本相同的书可以卖几十万册都可以，在佳缘这么干就不行。电商可以搞个畅销榜让用户购买最畅销的书，这其实也是很好的推荐。但对于佳缘这一招就很糟糕。
* **转化链很长，反馈延迟**：从展示到发信，再到看信和回信，过程很长，而且看信和回信会有很长的时间延迟。收益在链的末端才能体现，公司的收益在看信后才能体现，而用户的收益在回信后才能真正体现。

  ![转化链很长，反馈延迟][long_conv]

上面的这些特点，加上团队在使用算法上经验不够，让我决定把接下来的算法优化方向放在特征工程上，而算法就限制在最简单的**逻辑回归（Logistic Regression）**。逻辑回归足够简单，解释性好，也有很好的开源实现。团队在处理特征的过程中可以积累对数据的处理经验，以及对业务的理解。从它开始也可以让团队在算法使用上积累心得。这是“战术”上的选择。

“战略”上，我们把上图中每一步转化作为单独的问题分别进行优化，这样逻辑回归就适用于每一步了。

上面说的“战略”和“战术”，其实针对的都是推荐系统里的排序系统。当时我对推荐系统流程的理解如下图，其中第一步是以满足运营需求为目标获得候选集，而第二步是根据用户（双方）的喜好对候选集进行重排。

  ![佳缘推荐系统流程图（2014）][flow2014]


2014年是工程年。


###离职潮
2014年初团队里很多人离职，快占到总人数的一半。再加上一些新招的人极度不靠谱，食言而肥，耽误了不少交接时间。那段时间包括我在内，所有剩下的人都压力很大。非常感谢当时留下来和我一起并肩作战的兄弟们。

集中离职这事其实应该可以提前预防的，这样就可以提前做些人员储备。当时团队里不少员工都是在佳缘呆了两三年了，所以可以预见会有一些人离职。只是我管理经验不足，之前没遇到过这种问题，所以当团队动荡较大时我自己都有点慌乱。

后来挺过来的感觉还是很爽的。一个是因为作为团队leader，我最终还是稳定了局面，团队人员的变动基本没有影响到团队的职能，在做的事情基本还是顺利在开展。这让我在团队管理上更有自信，对于人员离职看的也比以前淡了。另一个是作为个人我承受住了当时的压力，自己亲自接下了不少重型项目，硬着头皮把代码全都读明白了。这也让我搞清楚了一些以前不清楚的项目细节，为接下来确定工作方向帮助很大。

###产品年
* 技术为产品服务，而不是直接面向用户；
* 

###Deep Learning尝试
利用佳缘的用户头像数据，尝试了DL里的一些常用算法.为了看算法的效果，我把用户的性别作为预测目标。这种预测对于佳缘的业务直接意义不大，因为用户在注册时就被要求填写其性别。

算法预测的效果还是不错的，准确度达到了87%。这还是在很小训练数据集上训练后获得的精度。麻烦是训练需要调整的超参数实在是挺多的，这就导致调参费时费机器。


###关于管理的思考
* 公司不需要讲民主，公司不是做慈善；
* 以贡献为导向，而不是开发人员的兴趣；只有结果才能证明实力；
* 遇到问题请先思考，只反映问题是初级水平，思考并解决问题才是高级水平；
* 职级标准：初级工程师需要别人明确做事具体步骤，而高级工程师只需明确事情的目标；资深工程师（技术经理）应该能自己主动找事做；
* 让工作尽量标准化，统一标准；
* 做事时要避免专家心态，别自己知道就以为别人也应该知道；
* 争取利益（或其他）时以数据为导向，让代替你数据说话；比如说调薪这事，凭什么给你调，这得通过你的成果数据说清楚，不然怎么判断是该给你调而不是给别人调；
* 往往做某个事的人，反而自己容易忽略这个事；
* 当遇到看似不可能的事，不要用自己的直觉就直接将其拍死，而应该先仔细考虑下是否有可行方案；一辆车里能装多少兵乓球？一个城市有多少窗户？
* 做技术的人的缺点：过于谨慎，当听到有风险的事时，首先考虑到的是风险，而不是带来的收益；老板说了个很好的例子：打牌。我现在听到打牌时确实考虑更多的是自己可能输钱，而不是赢钱。
* 一旦下属做错事，不要想当然地说是他们执行力差，应该先从自己身上找问题，是计划制定得容易出错？还是分配给每人的工作不合理？不要把下属的执行力差变成一种推卸责任的借口！

###关于看书的思考
* 看东西要以学到东西为目标，而不是以看东西为目标。



###关于人性的思考
* 爱承诺的人，通常其承诺都不可信；
* 从利益角度考虑问题，基本可以解释正常人做的所有事；
* 人可以分为这几代，其实也就是按照马斯诺需求划分的：
  1. 还在为温饱问题努力；追求收入；
  2. 刚刚解决温饱问题；追求收入，但也渴望提升生活质量；但他们很难有高的艺术修养；
  3. 追求生活质量，也追求艺术；他们通常有一定的艺术细胞；
  4. 追求哲学，宗教；他们有较高的艺术修养。
  
  大家常说北京高考容易，在其他小地方就难得多。其实这种比较是拿两个级别（3 vs 2）的人做对比，所以压根没啥对比性。所以不要以为不公平，只能怪你的前辈们不够努力。


###Focus
2014年我自己逐渐意思到团队成员同时做的事太多，导致精力分散。所以我也逐渐在调整，让每个人在一段时间内尽量focus在一个项目。

这样做的好处除了把劲往一处使外，还有个好处就是让做事的人没有后退的理由。当一个人同时做多个项目时，他们会有侥幸心理，这个项目没做好，另一个项目可能能做好，结果就是哪个项目都没使全力。在结果不好时他们也很容易给自己找理由。


##体会
###不够主动去接触业务机会，现有的很多机会都来自于老板的要求，如魅力会员，网警，VIP




[long_conv]: /images/dating_attr_long_conv.png "转化链很长，反馈延迟"
[flow2014]: /images/flow2014.png "佳缘推荐系统流程图（2014）"

[big_pic]: http://pan.baidu.com/s/1hqBX1h6 "清晰图"



#References

[^ml_things]: Pedro Domingos. [A few useful things to know about machine learning](http://homes.cs.washington.edu/~pedrod/papers/cacm12.pdf), 2012.