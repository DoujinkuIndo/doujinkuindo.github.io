---
layout: post
title: 测试环境搭建
---
客户提供了数据，希望能在我们的系统里批量的把现有的数据跑一跑，来测试我们系统的功能，因此需要给该客户提供一个用于测试的环境。

原本仅动用了两台虚拟机布上了我们的应用，但因为种种原因，跑数据的结果总是不太令人满意。随着时间日渐紧迫，为了得到更准确的结果并加快执行的速度，在跟波哥确认过之后，还是决定重新布一套环境，采用数据切分的方式，多线程并发的来跑。

虽然已经布过一次环境，但在布全新的环境的时候还是遇到了许多问题。下面是我在部署环境的时候遇到的一些问题，以及些许心得。

### 编译应用

部署环境的第一件事就是先准备好要部署的应用。

我们的应用虽然是用maven命令来自动编译打包的，但是其中还是有很多需要配置的项。其中最主要的就是我们应用的两个properties配置文件和启动脚本目录下的env脚本。

务必要保证里面的各项配置都是正确可用的，这样在后面启动应用的时候可以减少因为环境设置导致的错误，确保一次成功。

### 选择部署方式

我们的应用比较简单的部署方式有两种：
1、从git上拉源码，修改配置后直接编译部署
2、仅仅部署已经配置编译好的war包

这两种方法各有优缺点。

拉源码的方式可以很方便的进行变更，但每次变更完需要重新编译。如果在多台机器上使用这种部署方式，编译启动太麻烦，速度也较慢。

仅部署war的方式适合稳定版本应用在多台机器上的快速部署，只需要在本地编译成war包，然后把war包部署到各台机器上启动就行了，但缺点是响应变更的速度较慢。

以上两种方式可以灵活根据自己的需要选择。如果需要快速响应变更，就选择拉源码编译的方式；如果是稳定版本的部署，可以选择war包部署的方式。总之，两种方式本质上都是一样的，都是使用tomcat来运行打包出来的war，没有根本上的差别。

### 配套应用

我们的应用使用了多种开源的软件产品。因此应用的启动也依赖这些配套的应用服务。

主要的环境有：
× 数据库
× 缓存
× 负载

在启动应用之前，要确保这些服务是可用的。

### 需要注意的问题

再次部署应用的过程中，我还是遇到了几个问题。
1、数据库表结构导出时遗漏
2、tomcat版本（我们的接口应用需要使用专门版本的tomcat）
3、高级搜索节点的配置

都是很小的问题，细心一点就可以避免。

另外在合并代码分支的时候还出现了代码冲突的问题。
