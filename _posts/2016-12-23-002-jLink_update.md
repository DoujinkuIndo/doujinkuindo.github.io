---
layout: post
title: jekyll-now にサムネイル表示機能を追加
---

Amazonのリンクを張ろうと思ったら、amazon-ecsでドはまりしたので、リンクのhoverでサムネイルを表示できるようにしました。元になったのは [Download_j_Link_Preview_Free_Java_Code](http://www.java2s.com/Open-Source/Javascript_Free_Code/Image_jQuery/Download_j_Link_Preview_Free_Java_Code.htm) よりコードを頂きました。

<!--break-->
開発元の設計では『特定の属性を持っているリンク』をサムネイル表示させる、または『すべてのリンクをサムネイル生成する』が選べるようになっています。ただ、この状態ですと、jekyllの生成したリンクは属性がないため（面倒くさくてつけないことが多いため）、『すべてのリンクをサムネイル生成する』を選ぶことになります。すると、今度は Read More とpermanent Linkがサムネイルを作り始めるため、ポップアップの嵐になり、イマイチです。

ということで、 `jquery-jLinkPreview-1.0.0.js` に下記の変更を入れました。

- 親要素に特定のモノが居る場合 or 自分が特定のclassに所属していたら除外する

```javascript
        settings = {
            ...
            'elementsRejectParenet': '',
            'elementsRejectClass': '',
            ...
        };
```

- あとは、eventハンドラにreturnコードを挟んでポップアップをキャンセルする

```javascript
    if(settings['preload'] == true) {
        $(targetA).each(function(event) {
            if (settings['elementsRejectClass'] != "") {
                if($(this).attr("class") == settings['elementsRejectClass']) {
                    return;
                }
            }
            if(rejectParents.length > 0) {
                for(j = 0; j < rejectParents.length; j++) {
                    if ($(this).parents(rejectParents[j]).size() > 0) {
                        return;
                    }
                }
            }
```

```javascript
    $(targetA).hover(function(event) {
        if (settings['elementsRejectClass'] != "") {
            if($(this).attr("class") == settings['elementsRejectClass']) {
                return;
            }
        }
        if(rejectParents.length > 0) {
            for(j = 0; j < rejectParents.length; j++) {
                if ($(this).parents(rejectParents[j]).size() > 0) {
                    return;
                }
            }
        }
```
かなり無理やり感あふれるループですが……なんとか動いたのでOK。正直、正しい実装をするならば、Rejectしていない要素に先にclassを自動付与して、そのclassにfunctionつけたほうが正しいのだと思います。現在のコードですとリンクにフォーカスするたびにfor文がちこちこ周るので。

- 今回お世話になったのは下記サイトさんでした。
 - [Download_j_Link_Preview_Free_Java_Code](http://www.java2s.com/Open-Source/Javascript_Free_Code/Image_jQuery/Download_j_Link_Preview_Free_Java_Code.htm)
 - [wimg.ca/manual](http://wimg.ca/manual)
 - [jQuery日本語マニュアル](http://semooh.jp/jquery/)

取り敢えず、少しずつパーツがそろってきた気がします。ありがとうございました。
