---
layout: post
title:  URL 访问网站的整个过程
date:   2017-08-31 09:35:00 +0800
categories: 网络
tag: 学习笔记
---

* content
{:toc}
# URL访问网站

1. 本地过程

   若DNS缓存中没有相关数据，则浏览器先向DNS服务器发出DNS请求，返回DNS对应的IP地址

   ~~~
   DNS请求阶段：
   DNS服务单元生成DNS报文—>UDP协议单元->IP协议单元->数据帧，这个过程包含了ARP解析
   DNS服务器接收阶段：
   接收到数据帧->IP协议单元->UDP协议单元->DNS服务单元将域名解析成ip地址
   DNS回应阶段：
   DNS回应报文->UDP协议单元->IP协议单元->数据帧(MAC)->请求域名解析的主机
   DNS解析结果接收阶段：
   数据帧->IP协议单元->UDP协议单元->DNS->浏览器
   ~~~

2. 浏览器与目标服务器建立TCP连接：三次握手

   * 浏览器想服务器发送TCP连接请求报文，请求TCP报文中的SYN标志位被设置为1，表示连接请求（**第一次握手**）

     ~~~
     TCP请求报文->IP->MAC->网关->请求服务器
     ~~~

   * 服务器收到数据帧，传送到上层的IP，TCP，TCP协议单元回应请求应答报文

   * 请求应答TCP报文中的SYN和ACK标志位俊被设置成1，表示连接请求应答（**第二次握手**）

     ~~~
     TCP请求应答报文->IP->MAC->网关->请求主机
     ~~~

   * 请求主机收到数据帧，发送到上层的IP，TCP，TCP协议单元会回应请求确认报文

   * 请求应答TCP报文中的ACK标志位被设置成1，表示连接请求报文（**第三次握手**）

     ~~~
     TCP请求确认报文->IP->MAC->网关->目标服务器
     ~~~

   * 目标服务器收到数据帧->IP->TCP，连接建立完成

3. 浏览器开始HTTP访问过程

   * 浏览器想目标服务器发出HTTP-GET/POST/HEAD 方法报文

     ~~~
     get,post,head请求方法的区别
     get:发送的数据量比较少（最多1024字节），且是明文传输的，数据放在请求协议头中，常用于请求
     post：发送的数据量比较大（无限制），且是密文传输，数据放在实体数据当中，多用于更新站点
     head：只请求指定页面的首部
     ~~~

   * 该HTTP-GET/POST/HEAD报文->TCP->IP->MAC->网关->目标主机

   * 目标主机收到数据帧->IP->TCP->HTTP，http协议单元会回应HTTP协议格式封装好的HTML超文本形式数据

   * HTTP-HTML数据->TCP->IP->MAC->网关->请求主机

   * 请求主机收到数据帧->IP->TCP->HTTP->浏览器，浏览器会以网页形式显示HTML超文本。

4. 断开TCP连接：TCP断开连接的四次握手

   * 浏览器想目标服务器发出TCP连接结束请求报文

   * 该请求TCP报文中的FIN标志位被设置为1，表示结束请求（**第一次握手**）

     ~~~web-idl
     TCP结束请求报文->IP->MAC->网关->目标服务器
     ~~~

   * 目标服务器收到数据帧->IP->TCP，TCP协议单元会回应结束应答报文

   * 这时候服务器因为还有数据需要发送，只能先确认收到客户端的结束请求报文，也就是发送ACK回应报文，这时候客户端已经没有数据发送了，处于FIN_WAIT状态（**第二次握手**）

   * 当服务器数据发送完毕，则向客户端发动FIN报文（**第三次握手**）

   * 客户端收到FIN报文后，发送ACK报文后进入TIME_WAIT状态（**第四次握手**）

   * 服务器收到ACK后断开连接，客户端在服务器断开连接后关闭连接