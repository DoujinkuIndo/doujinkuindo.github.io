---
layout: post
title: First Person Horror Character
---

오늘 목표
1. v PlayerController에서 인풋 처리 -> Character에서 RPC(remote procedure call)함
    - 생각해보니 MovementComponent를 이용하기 때문에 RPC를 호출할 필요 없음. 알아서 리플리케이션 해줌.
    - 기본적인 움직임은 캐릭터에 바인드 하고 그외의 입력은 PlayerController에서 처리하도록 구현해야함.
2. v Character -> AnimInstance로 애니메이션
3. v AnimSequence -(Notify)> AnimInstance로 발소리, CameraShake
    - FootStep 거기에 오버라이드 겁나 잘되어 있음. MI 보고 만들도록 합시다.
    - 이거는 소리를 들을 수 있어야 만들 수 있다. 사운드 머티리얼과 합치도록 하자. 
    - 참고를 하자 약간 부족하다.

UE 4.27

# 캐릭터 컨트롤러와 캐릭터 플레이어
스캘레톤은 언리얼의 기본 스켈레톤을 이용합니다.

**런타임중 캐릭터가 변경될 수 있으므로**(또는 멀티플레이의 경우) 캐릭터에 제한적인; 무브먼트, 때로는 카메라를 제외하고, 플레이어 컨트롤러에서 폰으로 명령을 내리는 식으로 결정됩니다.

* 무브먼트와 관련된 입력은 캐릭터에서 바인드됩니다.
* 에로 UI 등의 입력은 컨트롤러에서 바인드됩니다.
* 폰의 데이터는 휘발성입니다.

## 캐릭터의 무브먼트
* 언리얼의 PawnCharacterMovement를 이용합니다.
* 캐릭터의 애니메이션은 CharacterMovement의 상태를 반영합니다.

## 활성화된 카메라와 스켈레탈 메시의 Opacity설정
Material Expression의 Camera Position은 랜더하는 Camera의 월드스페이스를 반환합니다.

이를 이용하여 거울을 위해 사용하는 랜더타겟과, 카메라가 캐릭터를 통과할 때 나타나는 Opacity를 다르게 할 수 있습니다.

## 캐릭터 인풋의 처리
플레이어 캐릭터에 플레이어 컨트롤러가 빙의가 끝났을 때 인풋을 바인딩합니다.
* 기본적으로 SetupPlayerInputComponent는 Pawn의 PawnClientRestart메서드에서 호출됩니다.

# 애니메이션
애니메이션의 조작 및 추가는 레벨 시퀀스에서 링크드 애니메이션을 만듬으로써 작업할 수 있습니다.

애니메이션 시퀀스 에디터 메뉴의 창/애니메이션 데이터 모디파이에서 애니메이션 데이터 모디파이로, 노티파이 및 커브를 자동화 할 수 있습니다.

애님 인스턴스에서 피직스를 리지드 바디 노드를 통하여, 자연스럽게 할 수 있습니다. 이때 피직스 애셋을 생성한 후 오버라이드 하여 부분적으로 리지드 바디를 적용할 수 있습니다.

트레이스를 목적으로 애니메이션 노드를 만들어서, 애니메이션의 중간 본 결과를 이용해서 레이 트레이스 할 수 있습니다. 이를 이용해 Foot IK를 구현할 수 있습니다. 하지만, 다음 번 발의 Foot이 지면에 충돌하는 포지션을 예측 할 수 있다면, 보다 수준높은 애니메이션을 만들 수 있습니다. FootIK를 구현할 때는 힐과 토에 대해서 생각해야 합니다.

## 걷는 경우
### Foot IK
Animation Node를 추가하여, IK를 결정.
힐과 토에 대해서 지면에 고정시킬 수 있다.
    - 적당히 만들어진 포즈를 자연스럽게 복구하는 패스를 만든다.
    - 다른 스켈레탈의 본 콜리전 위에 현재 스켈레탈의 본 콜리젼이 적용되는 경우는 포기한다.
        - 멀티 쓰레드로 애니메이션이 업데이트 되는 상황에서 이를 동기화할 실력이 안된다.
    - 레이 케스트를 이용한 IK 포지션은 t-1초로 결정된다.
        - 애니메이션으로 부터 발이 지면에 도달할 위치를 미리 계산하는 걸 만들 자신이 없다.

### Input Axis에 바인딩

1. 카메라 쉐이크 추가

2. 발소리 출력
* 애니메이션 노티피 이벤트에 연결할 수 있음.

## 뛰는 경우
### On Landed 이벤트에 바인딩
1. 땅에 떨어짐

2. 낙하 데미지 추가

3. 카메라 쉐이크 추가

## 지형지물과 상호작용 하는 경우

머리 아픕니다.