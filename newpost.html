---
layout: default
permalink: /newpost/
jquery: true
javascripts: [/js/d3.min.js, /js/c3.min.js, /js/parseGet.js]
csses: [/css/c3.css, /css/debtChart.css]
---

<div id="balance-chart" style="width: 90%; height: 300px;"></div>
<form name="form1" method="GET">		
    <table id="debt-table">
        <tr>
            <th>Debt</th>
            <th>Starting Balance</th>
            <th>Rate</th>
            <th>Payment</th>
            <th>Minimum Payment</th>
            <th>Minimum Payment Type</th>
        </tr>
    </table>
    <input type="submit" value="Submit">
</form>
<script type="text/javascript">    
function createDebt(name, balance, rate, payment, minpayment, minpaymenttype) {
    return {
        name: name,
        balance: balance,
        rate: rate,
        payment: payment,
        minpayment: minpayment,
        minpaymenttype: minpaymenttype,
        snowball: 0,
        getMinPayment: function() {
            if(this.minpaymenttype == 'percent') {
                return Math.round(this.balance*this.minpayment);
            } else {
                return this.minpayment;
            }
        },
        update: function() {                    
            this.balance = this.balance * (1 + this.rate / 12) - this.payment;
            this.balance = Math.round(this.balance);

            if(this.balance < this.payment){
                if(this.getminpaymenttype=='dollar'&&this.balance<this.minpayment){
                    this.minpayment = this.balance;
                }
                this.snowball = this.payment - this.balance;
                this.payment = this.balance;
            }

            if(this.balance <= 0) {
                this.balance = 0;
                this.minpayment = 0;
                this.snowball = this.payment;
                this.payment = 0;
            }
        }
    };
}

function avalanche(items) {
    var snowballs = items.reduce(function(p, c) {return p + c.snowball;}, 0);
    
    if(snowballs > 0) {
        var toSnowball = items.filter(function(item) {return item.snowball == 0;});
        
        items.forEach(function(item) {item.snowball = 0;});
        
        if(toSnowball.length > 0) {
            var avalanche = highestRate(toSnowball);
            avalanche.payment = avalanche.payment + snowballs;
        }
    }
}

function sumBalances(items) {
    return items.reduce(function(p, c){return p + c.balance;}, 0);
}

function sumMinpayments(items) {
    return items.reduce(function(p, c) {return p + c.getMinPayment();}, 0);
}

function lowestBalance(items){
    return items.reduce(function(p, c) {
        if(p == null) {return c;}
        else if(p.balance > c.balance) {return c;}
        else {return p;}
    });
 }

function highestRate(items) {
    return items.reduce(function(p, c) {
        if(p == null) {return c;}
        else if(p.rate < c.rate) {return c;}
        else{return p;}
    });
}

function getBalances(items) {        
    var balances = [[0,sumBalances(items), sumMinpayments(items)]];

    var month = 1;

    while (sumBalances(items) > 0) {
        items.forEach(function(item) {item.update();});
        balances.push([month,sumBalances(items), sumMinpayments(items)]);
        
        avalanche(items);
        month++;
        
        if(month > 500) {
            break;
        }
    }

    return balances;
}

$(document).ready(function() {
	var everything = new Array();

	if(hasKey('name') && hasKey('balance') && hasKey('rate') && hasKey('payment') && hasKey('minpayment')) {
		var keyValues = getKeyValuePairs();
		
		for(var i = 0; i < keyValues.length; i++) {
			var keyValue = keyValues[i];
			
			var name;
			var balance;
			var rate;
			var payment;
			var minpayment;
			var minpaymenttype = 'dollar';
			
			switch(keyValue[0]) {
				case 'name':
					if(name !== null) {
						everything.push(createDebt(name, balance, rate, payment, minpayment, minpaymenttype));
					} 
					
					name = keyValue[1];
					break;
				case 'balance':
					balance = keyValue[1];
					break;
				case 'rate':
					rate = keyValue[1];
					break;
				case 'payment':
					payment = keyValue[1];
					break;
				case 'minpayment':
					minpayment = keyValue[1];
					break;
				case 'minpaymenttype':
					minpaymenttype = keyValue[1];
			}
		}
	} else {
		var house = createDebt('mortgage', 20000, 0.06, 1000, 100, 'dollar');
		var car = createDebt('car loan', 20000, 0.1, 250, 250, 'dollar');
		var creditcard = createDebt('credit card', 5000, 0.20, 100, 0.04, 'percent');
		everything = [house, car, creditcard];
	}
    
    for(var i = 0; i < everything.length; i++) {
        var debt = everything[i];
        
        var nameString = "<input type='text' name='name' value='" + debt.name + "' />";
        var balanceString = "$<input type='number' name='balance' value='" + debt.balance + "' />";
        var rateString = "<input type='number' name='rate' min='0' max='100'  value='" + debt.rate * 100 + "' />%";
        var paymentString = "$<input type='number' name='payment' min='0' value='" + debt.payment + "' />";
        var minpaymentString = "<input type='number' name='minpayment' min='0' ";
        var minpaymenttypeString = "<select name='minpaymenttype'><option value='dollar'" 
            + (debt.minpaymenttype == 'dollar' ? ' selected' : '') 
            + ">dollar</option><option value='percent'" 
            + (debt.minpaymenttype == 'percent' ? ' selected' : '')
            + ">percent</option></select>";
        
        if(debt.minpaymenttype == 'percent') {
            minpaymentString = minpaymentString + "max='100' value='" + debt.minpayment * 100 + "' />%";
        } else {
            minpaymentString = "$" + minpaymentString + "value='" + debt.minpayment + "' />";
        }
        
        var row = '<tr><td>' + nameString + '</td><td>' 
            + balanceString  + '</td><td>' 
            + rateString + '</td><td>' 
            + paymentString + '</td><td>' 
            + minpaymentString + '</td><td>' 
            + minpaymenttypeString + '</td></tr>';
        
        $('#debt-table').append(row);
    }

    var balances = [['month', 'balance', 'minimum payment']];
    balances = balances.concat(getBalances(everything));

    var chart = c3.generate({
        bindto: '#balance-chart',
        data:{x: 'month', rows:balances, type:'spline'},
        axis:{x: {label: {text: 'month', position: 'outer-center'}},
              y: {label: {text: 'dollars', position: 'outer-middle'}}}
    });
});
</script>
