function spring_clearScreen(a,b){a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,b.width,b.height)}function spring_getMousePos(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}function spring_getRandomColor(){var a=Math.round(255*Math.random()),b=Math.round(255*Math.random()),c=Math.round(255*Math.random());return"rgb("+a+","+b+","+c+")"}function spring_box(a,b,c,d,e){this.x=a,this.y=b,this.width=c,this.height=d,void 0==e?this.mass=0:this.mass=e,this.color=spring_getRandomColor(),this.draw=function(a){a.fillStyle=this.color,a.fillRect(this.x,this.y,this.width,this.height)},this.isPointInBox=function(a,b){return!(a<this.x)&&(!(b<this.y)&&(!(a>this.x+this.width)&&!(b>this.y+this.height)))},this.overLapsBox=function(a){return!!spring_box.isPointInBox(this.x,this.y)||(!!spring_box.isPointInBox(this.x+this.width,this.y)||(!!spring_box.isPointInBox(this.x,this.y+this.height)||!!spring_box.isPointInBox(this.x+this.width,this.y+this.height)))},this.overLapsBoxes=function(a){for(var b=0;b<a.length;b++)if(a[b].overLapsBox(this))return!0;return!1}}function spring(a,b,c,d,e){this.fixedX=a,this.fixedY=b,this.moveX=c,this.moveY=d;var f=this.moveX-this.fixedX,g=this.moveY-this.fixedY;this.unstretchedLength=Math.sqrt(f*f+g*g),this.k=e;var h=.5*this.unstretchedLength;this.dx=function(){return this.moveX-this.fixedX},this.dy=function(){return this.moveY-this.fixedY},this.length=function(){var a=this.dx(),b=this.dy();return Math.sqrt(a*a+b*b)},this.displacement=function(){return this.length()-this.unstretchedLength},this.force=function(){return-this.k*this.displacement()},this.draw=function(a){var e,b=this.dx(),c=this.dy(),d=Math.sqrt(b*b+c*c);e=0==c?b>=0?0:Math.PI:c>0?Math.PI/2-Math.atan(b/c):Math.atan(-b/c)-Math.PI/2,a.save(),a.setTransform(1,0,0,1,0,0),a.translate(this.fixedX,this.fixedY),a.rotate(e),a.lineWidth="1",a.strokeStyle="black",a.moveTo(0,0),a.beginPath();var f=0,g=0;a.lineTo(f,g),f=.05,g=1,a.lineTo(f*d,g*h),f+=.1,g=-1;for(var i=0;i<9;i++)a.lineTo(f*d,g*h),f+=.1,g=-1*g;g=0,f-=.05,a.lineTo(f*d,g*h),a.stroke(),a.restore()}}function spring_drawEverything(a,b){for(var c=0;c<a.length;c++)a[c].draw(b)}$(document).ready(function(){var f,a=null,b=new Array,c=$("#spring").get(0),d=c.getContext("2d"),e=!1,g=50,h=50,i=c.width/2-g/2,j=c.height/4,k=new spring_box(i,j,g,h);b.push(k);var l=i,m=j+2*h,n=new spring_box(l,m,g,h,50);b.push(n);var o=i+g/2,p=j+h,q=o,r=m,s=new spring(o,p,q,r,.5);b.push(s),spring_drawEverything(b,d),$("#spring").mousedown(function(b){var d=spring_getMousePos(c,b);n.isPointInBox(d.x,d.y)&&(window.clearInterval(a),e=!0,f=d)}),$("#spring").mousemove(function(a){if(e){var g=spring_getMousePos(c,a),h=g.x-f.x,i=g.y-f.y;f=g,n.x=n.x+h,n.y=n.y+i,s.moveX=s.moveX+h,s.moveY=s.moveY+i;var j=-s.force();$("#length").html(s.length().toString()),$("#force").html(j.toString()),spring_clearScreen(d,c),spring_drawEverything(b,d)}}),$(window).mouseup(function(){e=!1;var f=0,g=0,h=0,i=1e3/60;a=window.setInterval(function(){var a=s.force(),i=a/n.mass;f+=i,0!=s.dx()&&0!=s.dy()?(g=s.dx()*f/s.length(),h=s.dy()*f/s.length()):0==s.dx()&&0!=s.dy()?(g=0,h=f):0!=s.dx()&&0==s.dy()&&(g=f,h=0),n.x+=g,s.moveX+=g,n.y+=h,s.moveY+=h,$("#length").html(s.length().toString()),$("#force").html(a.toString()),$("#acc").html(i.toString()),$("#velocity").html(f.toString()),spring_clearScreen(d,c),spring_drawEverything(b,d)},i)})});
