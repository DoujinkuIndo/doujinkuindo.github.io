/*
Last Updated: 2016年6月10日 11:07:03

COTA
http://cota.jp
*/
(function(a,b){var c=a.jQuery;if(typeof define==="function"&&define.amd){if(c){define([],b.bind(null,c))}else{define(["jquery"],b)}}else{if(typeof exports==="object"){if(c){module.exports=b(c)}else{module.exports=b(require("jquery"))}}else{if(c){a.setIframeHeight=b(c)}else{throw"Missing required jQuery dependency"}}}}(this,function(b){b(window).bind("setIframeHeight",e).bind("message",j);var c={setHeight:function(k){k.height=parseInt(k.height,10);b(window).trigger("setIframeHeight",[k])}};var g={};function h(l){var k=null;b("iframe").each(function(m,n){var o=b(n);var p=o.attr("data-iframeAutoHeight-currentSrc")||n.src;if(p){p=a(p);if(p===l){k=n;return false}}});return k}function d(l){var k=null;b("iframe").each(function(m,n){var o=b(n);if(o.data("setIframeHeight_id")===l){k=n;return false}});return k}function a(k){if(k.indexOf("/")===0){k=f(document.location.href)+k}return k}function f(k){var l=k.match(/https?:\/\/.[^/]+/)||[];return l[0]}function i(k){return k.replace(/^https?:\/\//,"//")}function e(p,o){var n;n=d(o.iframeId);if(!n){n=h(o.iframeSrc)}if(!n&&o.iframeReferrer){n=h(o.iframeReferrer)}if(n){var s=b(n);var l=b(window);s.data("setIframeHeight_id",o.iframeId);s.height(o.height);var m=i(s.attr("data-iframeAutoHeight-currentSrc")||n.src)!==i(o.iframeSrc);s.attr("data-iframeAutoHeight-currentSrc",o.iframeSrc);var q=g[o.iframeId];var r=o.height;if(q===undefined){l.trigger("setIframeHeight:determined",o)}else{if(q>r){l.trigger("setIframeHeight:shrinked",o)}else{if(q<r){b(window).trigger("setIframeHeight:enlarged",o)}}}g[o.iframeId]=r;if(window.history.replaceState&&s.attr("data-iframeAutoHeight-deepLinkPattern")&&m){var k=a(s.attr("data-iframeAutoHeight-deepLinkPattern").replace(/%deepLinkIframeSrc%/,encodeURIComponent(o.iframeSrc)));if(i(document.location.href)!==i(k)){window.history.replaceState({},"",k);b(window).trigger("setIframeHeight:deepLink:changed",{childUrl:o.iframeSrc,parentUrl:k})}if(n.contentWindow&&n.contentWindow.postMessage){n.contentWindow.postMessage('setIframeHeight:deepLink:changed::{ "parentUrl": "'+k+'", "childUrl": "'+o.iframeSrc+'"}',"*")}}}}function j(l){var k=l.originalEvent.data;if(typeof k==="string"&&k.indexOf("::")){var k=k.split("::");if(k.length===2&&k[0]==="setIframeHeight"){var m=b.parseJSON(k[1]);c.setHeight(m)}}}return c}));